# ğŸ“¡ è¡Œå‹•é€šè¨Šèª²ç¨‹å°ˆæ¡ˆ #2

## é¡Œç›®èªªæ˜
åœ¨é€™å€‹å°ˆæ¡ˆä¸­ï¼Œæˆ‘å€‘è¦é€éæ¨¡æ“¬å¯¦ç¾ä¸€å€‹ **OFDM æ”¶ç™¼æ©Ÿ**ã€‚  
ç‚ºäº†ç°¡åŒ–æ¨¡æ“¬ï¼ŒDAC èˆ‡ ADC è¢«çœç•¥ï¼Œä½¿ç”¨çš„æ˜¯ **é›¢æ•£æ™‚é–“åŸºé »è¨Šè™Ÿæ¨¡å‹**ã€‚  
å‡è¨­å·²ç¶“é”æˆå®Œç¾çš„ **æ™‚é–“èˆ‡é »ç‡åŒæ­¥**ï¼Œä¸¦ä¸” **é€šé“è„ˆè¡éŸ¿æ‡‰å·²çŸ¥**ã€‚  

ä¾æ“šä¸Šåœ–æµç¨‹ï¼Œè³‡è¨Šä½å…ƒæœƒå…ˆè¢«èª¿è®Šï¼Œå†è¼¸å…¥è‡³ $M$ é» IDFT (IFFT)ã€‚  
åŠ å…¥å¾ªç’°å­—é¦– (Cyclic Prefix, CP) ä¹‹å¾Œï¼Œè¨Šè™Ÿ $x[n]$ è¢«é€å‡ºã€‚  

## ç³»çµ±åƒæ•¸
- FFT é»æ•¸ï¼š $M = 64$  
- è³‡æ–™å­è¼‰æ³¢æ•¸ï¼š $52$  
- å¾ªç’°å­—é¦–é•·åº¦ï¼š $16$ samples  
- èª¿è®Šæ–¹å¼ï¼š BPSK  
- å­è¼‰æ³¢ç´¢å¼•ï¼š  

$$
[7, 8, 9, 10, 11, 12, 13, 14,  
15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26,  
27, 28, 29, 30, 31, 32, 34, 35, 36, 37, 38, 39,  
40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51,  
52, 53, 54, 55, 56, 57, 58, 59]
$$

å…¶ä¸­ï¼Œ  

$$
D_k \in \{-1, +1\}
$$  

ç‚ºé€é BPSK èª¿è®Šå¾Œçš„ç¬¦è™Ÿã€‚  

## æ¥æ”¶è¨Šè™Ÿæ¨¡å‹
æ¥æ”¶è¨Šè™Ÿå¯è¡¨ç¤ºç‚ºï¼š  

$$
z[n] = x[n] * h[n] + n[n]
$$

å…¶ä¸­ï¼š  
- $x[n]$ ï¼šå‚³é€è¨Šè™Ÿ  
- $h[n]$ ï¼šé€šé“éŸ¿æ‡‰  
- $n[n]$ ï¼šåŠ æ€§ç™½é›œè¨Š (AWGN)  

---
## (I) å¯¦é©—ä¸€ï¼šæ˜Ÿåº§åœ–ç¹ªè£½

å·²çŸ¥é€šé“è„ˆè¡éŸ¿æ‡‰ï¼š  

$$
\tilde{h}[n] = [0.5 - 0.5j,\; 0,\; 0.15 + 0.12j,\; 0,\; 0,\; -0.1 + 0.05j]
$$  

ä¸¦ä¸”æ­£è¦åŒ–ç‚ºï¼š  

$$
h[n] = \frac{\tilde{h}[n]}{\text{norm}(\tilde{h}[n])}
$$  

### å¯¦é©—è¦æ±‚
- æ¨¡æ“¬ **å…©å€‹ OFDM ç¬¦è™Ÿé€±æœŸ**ï¼Œä¸¦ç¹ªè£½è¼¸å‡ºæ˜Ÿåº§åœ– (scatter plot)ã€‚  
- åœ¨ **$M$ é» DFT (FFT) è¼¸å‡º**è™•è§€å¯Ÿ $Y_k$ã€‚  
- ç”±æ–¼æœ‰ $2 \times 52 = 104$ å€‹å­è¼‰æ³¢é»ï¼Œå› æ­¤æ˜Ÿåº§åœ–æ‡‰åŒ…å« 104 å€‹é»ã€‚  
- é›œè¨Šæ¢ä»¶è¨­å®šç‚ºï¼š  

$$
\frac{E_b}{N_0} = 20 \ \text{dB}
$$  

å…¶ä¸­ $\frac{E_b}{N_0}$ æ˜¯åœ¨ FFT è¼¸å‡ºç«¯é‡æ¸¬çš„ã€‚  

### ç­‰åŒ–å™¨æ¸¬è©¦
- è«‹ç¹ªè£½é€šé **é »åŸŸç­‰åŒ–å™¨ (frequency domain equalizer)** å¾Œçš„æ˜Ÿåº§åœ–ã€‚  
- ç­‰åŒ–å™¨æ¡ç”¨ **é›¶è¿«é›¶ (Zero-Forcing) æº–å‰‡**ï¼š  

$$
\hat{D}_k = \frac{Y_k}{H_k}
$$  

- æ³¨æ„ï¼šéœ€è¦å°‡æ™‚åŸŸé€šé“è„ˆè¡éŸ¿æ‡‰ $h[n]$ è½‰æ›ç‚ºé »åŸŸéŸ¿æ‡‰ $H_k$ (é€é FFT)ã€‚  
---
## Matlab ver
```matlab
%% Mobile Communication Project #2 - OFDM Simulation
clear; clc; close all;

%% ç³»çµ±åƒæ•¸
M = 64;                 % FFT é»æ•¸
sc = 52;                % è³‡æ–™å­è¼‰æ³¢æ•¸
ofdm_bit = 52;          % æ¯å€‹ OFDM symbol çš„ bits æ•¸ (BPSK = 52)
Nsymbol = 100;          % æ¨¡æ“¬çš„ OFDM ç¬¦è™Ÿæ•¸
cp_len = 16;            % å¾ªç’°å­—é¦–é•·åº¦

%% ç”¢ç”Ÿéš¨æ©Ÿ bits ä¸¦åš BPSK èª¿è®Š
Data = randi([0 1], ofdm_bit * Nsymbol, 1);
dk = 2*Data - 1;                            % BPSK: 0â†’-1, 1â†’+1
dk_sym = reshape(dk, sc, Nsymbol);          % Serial â†’ Parallel

%% æ’å…¥å­è¼‰æ³¢ (52 å€‹è³‡æ–™å­è¼‰æ³¢)
Dk = zeros(M, Nsymbol);
Dk(7:32,:)  = dk_sym(1:26,:);               % å·¦ 26 å€‹å­è¼‰æ³¢
Dk(34:59,:) = dk_sym(27:52,:);              % å³ 26 å€‹å­è¼‰æ³¢

%% IFFT (è½‰å›æ™‚åŸŸ)
IDFT = ifft(Dk, M);

%% åŠ å…¥å¾ªç’°å­—é¦– (CP)
D_cp = [IDFT((M-cp_len+1):M,:); IDFT];      % å‰ 16 é»è¤‡è£½åˆ°æœ€å‰é¢
x_n = reshape(D_cp, 1, (M+cp_len)*Nsymbol);

%% é€šé“æ¨¡å‹ (å¤šè·¯å¾‘è¡°è½)
h = [0.5-0.5j, 0, 0.15+0.12j, 0, 0, -0.1+0.05j];
h = h ./ norm(h);                           % æ­£è¦åŒ–
xh = conv(x_n, h);

%% åŠ å…¥ AWGN (Eb/N0 = 20 dB)
Eb_N0 = 20;
Eb = mean(abs(x_n).^2);
Np = Eb*10^(-Eb_N0/10);
z = awgn(xh(1:end-5), Eb_N0, 'measured');

%% æ¥æ”¶ç«¯ï¼šç§»é™¤å¾ªç’°å­—é¦– (CP)
receiver = reshape(z, M+cp_len, Nsymbol);
rn = receiver(cp_len+1:end,:);              % å»æ‰ CP

%% FFT (è½‰å›é »åŸŸ)
DFT = fft(rn, M);

%% å–å‡º 52 å€‹æœ‰æ•ˆå­è¼‰æ³¢ (ç­‰åŒ–å‰)
Yk = [DFT(7:32,:); DFT(34:59,:)];
Yk_serial = reshape(Yk, 1, sc*Nsymbol);

%% ç¹ªè£½ç­‰åŒ–å‰æ˜Ÿåº§åœ–
figure;
scatterplot(Yk_serial(1:104));              % å–å‰ 2 å€‹ OFDM symbol
title('Constellation Before Equalization');

%% é »åŸŸç­‰åŒ– (Zero-Forcing)
Hn = fft(h, M);
Dk_eq = DFT ./ Hn.';                        % Zero-Forcing: Yk / Hk

%% å–å‡º 52 å€‹å­è¼‰æ³¢ (ç­‰åŒ–å¾Œ)
Dk_receiver = [Dk_eq(7:32,:); Dk_eq(34:59,:)];
Dkr_serial = reshape(Dk_receiver, 1, sc*Nsymbol);

%% ç¹ªè£½ç­‰åŒ–å¾Œæ˜Ÿåº§åœ–
figure;
scatterplot(Dkr_serial(1:104));
title('Constellation After Equalization');
```
---
## Python Ver
```python
import numpy as np
import matplotlib.pyplot as plt

# ----------------------------
# ç³»çµ±åƒæ•¸
# ----------------------------
M = 64                  # FFT é»æ•¸
sc = 52                 # è³‡æ–™å­è¼‰æ³¢æ•¸
ofdm_bit = 52           # æ¯å€‹ OFDM symbol bits æ•¸ (BPSK = 52)
Nsymbol = 100           # æ¨¡æ“¬ OFDM ç¬¦è™Ÿæ•¸
cp_len = 16             # å¾ªç’°å­—é¦–é•·åº¦

# ----------------------------
# ç”¢ç”Ÿéš¨æ©Ÿ bits ä¸¦åš BPSK èª¿è®Š
# ----------------------------
Data = np.random.randint(0, 2, ofdm_bit * Nsymbol)
dk = 2*Data - 1                         # BPSK: 0â†’-1, 1â†’+1
dk_sym = dk.reshape(Nsymbol, sc).T      # Serial â†’ Parallel (sc Ã— Nsymbol)

# ----------------------------
# æ’å…¥å­è¼‰æ³¢ (52 å€‹è³‡æ–™å­è¼‰æ³¢)
# ----------------------------
Dk = np.zeros((M, Nsymbol), dtype=complex)
Dk[6:32, :]  = dk_sym[0:26, :]          # å·¦ 26 å€‹å­è¼‰æ³¢ (æ³¨æ„ Python index å¾ 0 é–‹å§‹)
Dk[33:59, :] = dk_sym[26:52, :]         # å³ 26 å€‹å­è¼‰æ³¢

# ----------------------------
# IFFT (è½‰å›æ™‚åŸŸ)
# ----------------------------
IDFT = np.fft.ifft(Dk, n=M, axis=0)

# ----------------------------
# åŠ å…¥å¾ªç’°å­—é¦– (CP)
# ----------------------------
D_cp = np.vstack([IDFT[-cp_len:, :], IDFT])   # è¤‡è£½æœ€å¾Œ cp_len å€‹æ¨£æœ¬åˆ°æœ€å‰é¢
x_n = D_cp.reshape(-1)                        # ä¸²æ¥æˆä¸€ç¶­å‘é‡

# ----------------------------
# é€šé“æ¨¡å‹ (å¤šè·¯å¾‘è¡°è½)
# ----------------------------
h = np.array([0.5-0.5j, 0, 0.15+0.12j, 0, 0, -0.1+0.05j])
h = h / np.linalg.norm(h)                     # æ­£è¦åŒ–
xh = np.convolve(x_n, h)

# ----------------------------
# åŠ å…¥ AWGN
# ----------------------------
Eb_N0_dB = 20
Eb = np.mean(np.abs(x_n)**2)                  # å¹³å‡ bit èƒ½é‡
Np = Eb * 10**(-Eb_N0_dB/10)                  # é›œè¨ŠåŠŸç‡
noise = np.sqrt(Np/2) * (np.random.randn(len(xh)-5) + 1j*np.random.randn(len(xh)-5))
z = xh[:len(xh)-5] + noise                    # åŠ å…¥é›œè¨Š (å°é½Š MATLAB xh(1:end-5))

# ----------------------------
# æ¥æ”¶ç«¯ï¼šç§»é™¤å¾ªç’°å­—é¦– (CP)
# ----------------------------
receiver = z.reshape(Nsymbol, M+cp_len).T     # è®Šæˆ (M+cp_len) Ã— Nsymbol
rn = receiver[cp_len:, :]                     # å»æ‰ CP (ä¿ç•™ 64 é»)

# ----------------------------
# FFT (è½‰å›é »åŸŸ)
# ----------------------------
DFT = np.fft.fft(rn, n=M, axis=0)

# ----------------------------
# å–å‡º 52 å€‹æœ‰æ•ˆå­è¼‰æ³¢ (ç­‰åŒ–å‰)
# ----------------------------
Yk = np.vstack([DFT[6:32, :], DFT[33:59, :]])
Yk_serial = Yk.reshape(-1)

# ç¹ªè£½ç­‰åŒ–å‰æ˜Ÿåº§åœ–
plt.figure()
plt.scatter(np.real(Yk_serial[:104]), np.imag(Yk_serial[:104]))
plt.title('Constellation Before Equalization')
plt.grid(True)

# ----------------------------
# é »åŸŸç­‰åŒ– (Zero-Forcing)
# ----------------------------
Hn = np.fft.fft(h, M)                         # é€šé“é »ç‡éŸ¿æ‡‰
Dk_eq = DFT / Hn[:, np.newaxis]               # Zero-Forcing ç­‰åŒ–

# ----------------------------
# å–å‡º 52 å€‹å­è¼‰æ³¢ (ç­‰åŒ–å¾Œ)
# ----------------------------
Dk_receiver = np.vstack([Dk_eq[6:32, :], Dk_eq[33:59, :]])
Dkr_serial = Dk_receiver.reshape(-1)

# ç¹ªè£½ç­‰åŒ–å¾Œæ˜Ÿåº§åœ–
plt.figure()
plt.scatter(np.real(Dkr_serial[:104]), np.imag(Dkr_serial[:104]))
plt.title('Constellation After Equalization')
plt.grid(True)

plt.show()
```
---
## (I) Result
<img src="2.jpg" alt="2" width="50%">
<img src="3.jpg" alt="3" width="50%">

---
## (II) å¯¦é©—äºŒï¼šBER æ›²ç·šç¹ªè£½ (ç†æƒ³é€šé“)

### å¯¦é©—è¦æ±‚
- ç¹ªè£½ **ä½å…ƒéŒ¯èª¤ç‡ (BER) æ›²ç·š**ã€‚  
- èª¤ç¢¼ç‡çµ±è¨ˆéœ€åœ¨ä»¥ä¸‹è¨Šé›œæ¯”æ¢ä»¶ä¸‹é€²è¡Œï¼š  

$$
\frac{E_b}{N_0} = 0, \; 2, \; 4, \; 6, \; 8 \ \text{dB}
$$  

- é€šé“æ¨¡å‹ç‚º **ç†æƒ³é€šé“**ï¼š  

$$
h[n] = [1]
$$  

---

## (III) å¯¦é©—ä¸‰ï¼šBER æ›²ç·šç¹ªè£½ (å¤šè·¯å¾‘é€šé“)

### å¯¦é©—è¦æ±‚
- ç¹ªè£½ **ä½å…ƒéŒ¯èª¤ç‡ (BER) æ›²ç·š**ã€‚  
- èª¤ç¢¼ç‡çµ±è¨ˆéœ€åœ¨ä»¥ä¸‹è¨Šé›œæ¯”æ¢ä»¶ä¸‹é€²è¡Œï¼š  

$$
\frac{E_b}{N_0} = 0, \; 2, \; 4, \; 6, \; 8 \ \text{dB}
$$  

- é€šé“æ¨¡å‹ç‚º **å¤šè·¯å¾‘é€šé“**ï¼Œå…¶è„ˆè¡éŸ¿æ‡‰ç‚ºï¼š  

$$
h[n] = \frac{\tilde{h}[n]}{\text{norm}(\tilde{h}[n])}
$$  

åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œå› ç‚ºé€šé“å­˜åœ¨è¡°è½èˆ‡å¤šè·¯å¾‘æ•ˆæ‡‰ï¼Œæ¨¡æ“¬å¾—åˆ°çš„ BER æ›²ç·šæœƒèˆ‡ç†è«–å€¼æœ‰æ˜é¡¯å·®ç•°ã€‚


